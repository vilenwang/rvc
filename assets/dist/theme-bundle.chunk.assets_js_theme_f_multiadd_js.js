"use strict";
(self["webpackChunkflair_camden"] = self["webpackChunkflair_camden"] || []).push([["assets_js_theme_f_multiadd_js"],{

/***/ "./assets/js/theme/f/multiadd.js":
/*!***************************************!*\
  !*** ./assets/js/theme/f/multiadd.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Page)
/* harmony export */ });
/* harmony import */ var core_js_modules_es6_regexp_replace_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! core-js/modules/es6.regexp.replace.js */ "./node_modules/core-js/modules/es6.regexp.replace.js");
/* harmony import */ var core_js_modules_es6_regexp_replace_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es6_regexp_replace_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var core_js_modules_es6_array_find_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! core-js/modules/es6.array.find.js */ "./node_modules/core-js/modules/es6.array.find.js");
/* harmony import */ var core_js_modules_es6_array_find_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es6_array_find_js__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var core_js_modules_es6_object_set_prototype_of_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! core-js/modules/es6.object.set-prototype-of.js */ "./node_modules/core-js/modules/es6.object.set-prototype-of.js");
/* harmony import */ var core_js_modules_es6_object_set_prototype_of_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es6_object_set_prototype_of_js__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _page_manager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../page-manager */ "./assets/js/theme/page-manager.js");
/* harmony import */ var _bigcommerce_stencil_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @bigcommerce/stencil-utils */ "./node_modules/@bigcommerce/stencil-utils/src/main.js");
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! papaparse */ "./node_modules/papaparse/papaparse.min.js");
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(papaparse__WEBPACK_IMPORTED_MODULE_5__);
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.min.js");



function _inheritsLoose(t, o) { t.prototype = Object.create(o.prototype), t.prototype.constructor = t, _setPrototypeOf(t, o); }
function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }



var Page = /*#__PURE__*/function (_PageManager) {
  function Page() {
    return _PageManager.apply(this, arguments) || this;
  }
  _inheritsLoose(Page, _PageManager);
  var _proto = Page.prototype;
  _proto.onReady = function onReady() {
    // Classes
    this.classRow = '.multi-add__row';
    this.classResultMessage = '.multi-add__result';
    this.classAddButton = '.multi-add__add-button';
    this.classRemoveButton = '.multi-add__remove-button';

    // Class names
    this.classNameRowError = 'multi-add__row--error';

    // Functional assignments
    this.$form = $('.multi-add');
    this.$file = $('.csv-file');
    this.snippet = $(this.classRow)[0].outerHTML;
    this.lines = 1;
    this.searchTerms = [];
    this.resetState();
    this.bindEvents();
  };
  _proto.resetState = function resetState() {
    this.items = [];
    this.errors = [];
    this.currentLoop = 0;
  }

  // Loop errors, add class and change text
  ;
  _proto.handleErrors = function handleErrors() {
    var _this2 = this;
    var skuError = this.context.skuError;
    $(this.errors).each(function (i, element) {
      element.addClass(_this2.classNameRowError);
      // To add lang string
      element.children(_this2.classResultMessage).text(skuError);
    });
  }

  // Run AJAX calls one by one
  ;
  _proto.handleAjax = function handleAjax() {
    var _this3 = this;
    if (this.currentLoop < this.items.length) {
      _bigcommerce_stencil_utils__WEBPACK_IMPORTED_MODULE_4__["default"].api.getPage(this.items[this.currentLoop].url, {
        template: 'f/b2b/quick-add-response'
      }, function (err, response) {
        var scriptRegex = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;
        var cleanResponse = response.replace(scriptRegex, '').trim();
        if (err) {
          throw new Error(err);
        }
        if (cleanResponse.length) {
          _this3.items[_this3.currentLoop].target.children(_this3.classResultMessage).text(cleanResponse);
          $(_this3.items[_this3.currentLoop].target).addClass('multi-add__row--advisory');
        } else {
          _this3.items[_this3.currentLoop].target.children(_this3.classResultMessage).text($('.multi-add__submit-button').data('message'));
          $(_this3.items[_this3.currentLoop].target).attr('data-status', 'success').addClass('multi-add__row--success');
        }

        // Increment 'current' and run AJAX call again
        _this3.currentLoop++;
        _this3.handleErrors();
        _this3.handleAjax();
      });
    }

    // Last attempt, redirect only
    if (this.currentLoop === this.items.length) {
      // document.location.href = '/cart.php';
      this.fetchCounter();
      $('.multi_add__cart-button').css('display', 'inline-block');
    }
  };
  _proto.fetchCounter = function fetchCounter() {
    _bigcommerce_stencil_utils__WEBPACK_IMPORTED_MODULE_4__["default"].api.cart.getContent({
      template: 'f/cart/item-count'
    }, function (err, response) {
      if (response > 0) {
        $('body').trigger('cart-quantity-update', response);
      }
    });
  };
  _proto.handleButtonDisplay = function handleButtonDisplay() {
    var rows = this.$form.children(this.classRow);
    var removeButtons = rows.find(this.classRemoveButton);
    var addButtons = rows.find(this.classAddButton);
    var lastAddButton = $(rows[this.lines - 1]).find(this.classAddButton);
    if (this.lines > 1) {
      removeButtons.removeClass('multi-add__remove-button--last').removeAttr('disabled');
      addButtons.removeClass('multi-add__add-button--disabled').removeAttr('disabled', 'disabled');
      addButtons.not(lastAddButton).addClass('multi-add__add-button--disabled').attr('disabled', 'disabled');
    } else {
      removeButtons.addClass('multi-add__remove-button--last').attr('disabled', 'disabled');
      addButtons.removeClass('multi-add__add-button--disabled').removeAttr('disabled');
    }
  };
  _proto.handleAddLine = function handleAddLine(sku, qty) {
    var newLine = $(this.snippet).clone();
    if (sku && qty) {
      $(newLine[0].children[0]).val(sku);
      $(newLine[0].children[1]).val(qty);
    }
    $('.multi-add__submit-button').before(newLine);
    this.lines++;
    this.handleButtonDisplay();
  };
  _proto.handleRemoveLine = function handleRemoveLine(line) {
    if (line.is(':only-of-type')) {
      return;
    }
    line.remove();
    this.lines--;
    this.handleButtonDisplay();
  };
  _proto.handleItemSelect = function handleItemSelect(event, override) {
    var self = event ? $(event.target) : override;
    var relativeRow = self.parents('.multi-add__row');
    var rowIndex = relativeRow.index() - 1;
    var selectedSku = $.trim(self.text());
    var relativeInput = relativeRow.find('[data-multi-sku]');
    relativeInput[0].value = selectedSku;
    this.searchTerms[rowIndex] = selectedSku;
  };
  _proto.processForm = function processForm(event, form) {
    var _this4 = this;
    event.preventDefault();
    var allRows = $(form).children(this.classRow);
    var allMessages = allRows.find(this.classResultMessage);
    var addingtoCart = this.context.addingToCart;
    this.resetState();

    // For each row, add the URL and target to the items array
    allRows.each(function (index, row) {
      var target = $(row);
      var sku = target.find('[data-multi-sku]').val();
      var qty = target.find('[data-multi-qty]').val();
      if (!sku || !qty) {
        _this4.errors.push(target);
        return;
      }
      var url = "/cart.php?action=add&sku=" + sku + "&qty=" + qty;
      _this4.items.push({
        url: url,
        target: target
      });
    });

    // To add lang string
    allMessages.text(addingtoCart);
    this.handleAjax();
  };
  _proto.parseCSV = function parseCSV(event, _this) {
    $('.alertBox-message span').text('');
    $('.alertBox').hide();
    var file = event.target.files[0];
    var noSku;
    var noQty;
    var csvMissingSkuHeader = this.context.csvMissingSkuHeader;
    var csvMissingQtyHeader = this.context.csvMissingQtyHeader;
    (0,papaparse__WEBPACK_IMPORTED_MODULE_5__.parse)(file, {
      preview: 1,
      complete: function complete(results) {
        if (results.data[0].indexOf('sku') === -1) {
          noSku = true;
        }
        if (results.data[0].indexOf('qty') === -1) {
          noQty = true;
        }
        if (noQty || noSku) {
          if (noSku) {
            $('.alertBox-message span').append(csvMissingSkuHeader);
          }
          if (noQty) {
            $('.alertBox-message span').append(csvMissingQtyHeader);
          }
          $('.alertBox').show();
        } else {
          (0,papaparse__WEBPACK_IMPORTED_MODULE_5__.parse)(file, {
            header: true,
            dynamicTyping: false,
            skipEmptyLines: true,
            step: function step(row) {
              var sku = row.data[0].sku;
              var qty = row.data[0].qty;
              _this.handleAddLine(sku, qty);
            }
          });
        }
      }
    });
  }

  // Bind event handlers
  ;
  _proto.bindEvents = function bindEvents() {
    var _this5 = this;
    this.$form.on('click', this.classAddButton, function () {
      _this5.handleAddLine();
    });
    this.$form.on('click', this.classRemoveButton, function (event) {
      _this5.handleRemoveLine($(event.target).parent());
    });
    this.$form.on('change', '[data-multi-sku]', function (event) {
      var self = $(event.target);
      if (self.val()) {
        self.siblings(_this5.classResultMessage).text('');
        self.parent().removeClass(_this5.classNameRowError);
      }
    });
    this.$form.on('submit', function (event) {
      _this5.processForm(event, _this5.$form[0]);
    });
    this.$file.on('change', function (event) {
      _this5.parseCSV(event, _this5);
    });
  };
  return Page;
}(_page_manager__WEBPACK_IMPORTED_MODULE_3__["default"]);


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhlbWUtYnVuZGxlLmNodW5rLmFzc2V0c19qc190aGVtZV9mX211bHRpYWRkX2pzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQTBDO0FBQ0s7QUFDYjtBQUFBLElBRWJHLElBQUksMEJBQUFDLFlBQUE7RUFBQSxTQUFBRCxLQUFBO0lBQUEsT0FBQUMsWUFBQSxDQUFBQyxLQUFBLE9BQUFDLFNBQUE7RUFBQTtFQUFBQyxjQUFBLENBQUFKLElBQUEsRUFBQUMsWUFBQTtFQUFBLElBQUFJLE1BQUEsR0FBQUwsSUFBQSxDQUFBTSxTQUFBO0VBQUFELE1BQUEsQ0FDckJFLE9BQU8sR0FBUCxTQUFBQSxPQUFPQSxDQUFBLEVBQUc7SUFDTjtJQUNBLElBQUksQ0FBQ0MsUUFBUSxHQUFHLGlCQUFpQjtJQUNqQyxJQUFJLENBQUNDLGtCQUFrQixHQUFHLG9CQUFvQjtJQUM5QyxJQUFJLENBQUNDLGNBQWMsR0FBRyx3QkFBd0I7SUFDOUMsSUFBSSxDQUFDQyxpQkFBaUIsR0FBRywyQkFBMkI7O0lBRXBEO0lBQ0EsSUFBSSxDQUFDQyxpQkFBaUIsR0FBRyx1QkFBdUI7O0lBRWhEO0lBQ0EsSUFBSSxDQUFDQyxLQUFLLEdBQUdDLENBQUMsQ0FBQyxZQUFZLENBQUM7SUFDNUIsSUFBSSxDQUFDQyxLQUFLLEdBQUdELENBQUMsQ0FBQyxXQUFXLENBQUM7SUFDM0IsSUFBSSxDQUFDRSxPQUFPLEdBQUdGLENBQUMsQ0FBQyxJQUFJLENBQUNOLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDUyxTQUFTO0lBQzVDLElBQUksQ0FBQ0MsS0FBSyxHQUFHLENBQUM7SUFDZCxJQUFJLENBQUNDLFdBQVcsR0FBRyxFQUFFO0lBRXJCLElBQUksQ0FBQ0MsVUFBVSxDQUFDLENBQUM7SUFDakIsSUFBSSxDQUFDQyxVQUFVLENBQUMsQ0FBQztFQUNyQixDQUFDO0VBQUFoQixNQUFBLENBRURlLFVBQVUsR0FBVixTQUFBQSxVQUFVQSxDQUFBLEVBQUc7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QVEsQ0FBQ0gsTUFBSSxDQUFDNUcsa0JBQWtCLENBQUMsQ0FBQ3lCLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDL0M4QyxJQUFJLENBQUN1QyxNQUFNLENBQUMsQ0FBQyxDQUFDeEQsV0FBVyxDQUFDc0QsTUFBSSxDQUFDekcsaUJBQWlCLENBQUM7TUFDckQ7SUFDSixDQUFDLENBQUM7SUFFRixJQUFJLENBQUNDLEtBQUssQ0FBQ3lHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBQXhDLEtBQUssRUFBSTtNQUM3QnVDLE1BQUksQ0FBQzdCLFdBQVcsQ0FBQ1YsS0FBSyxFQUFFdUMsTUFBSSxDQUFDeEcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFDLENBQUMsQ0FBQztJQUVGLElBQUksQ0FBQ0UsS0FBSyxDQUFDdUcsRUFBRSxDQUFDLFFBQVEsRUFBRSxVQUFBeEMsS0FBSyxFQUFJO01BQzdCdUMsTUFBSSxDQUFDbkIsUUFBUSxDQUFDcEIsS0FBSyxFQUFFdUMsTUFBSSxDQUFDO0lBQzlCLENBQUMsQ0FBQztFQUNOLENBQUM7RUFBQSxPQUFBckgsSUFBQTtBQUFBLEVBL082QkgscURBQVciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mbGFpci1jYW1kZW4vLi9hc3NldHMvanMvdGhlbWUvZi9tdWx0aWFkZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGFnZU1hbmFnZXIgZnJvbSAnLi4vcGFnZS1tYW5hZ2VyJztcbmltcG9ydCB1dGlscyBmcm9tICdAYmlnY29tbWVyY2Uvc3RlbmNpbC11dGlscyc7XG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJ3BhcGFwYXJzZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBhZ2UgZXh0ZW5kcyBQYWdlTWFuYWdlciB7XG4gICAgb25SZWFkeSgpIHtcbiAgICAgICAgLy8gQ2xhc3Nlc1xuICAgICAgICB0aGlzLmNsYXNzUm93ID0gJy5tdWx0aS1hZGRfX3Jvdyc7XG4gICAgICAgIHRoaXMuY2xhc3NSZXN1bHRNZXNzYWdlID0gJy5tdWx0aS1hZGRfX3Jlc3VsdCc7XG4gICAgICAgIHRoaXMuY2xhc3NBZGRCdXR0b24gPSAnLm11bHRpLWFkZF9fYWRkLWJ1dHRvbic7XG4gICAgICAgIHRoaXMuY2xhc3NSZW1vdmVCdXR0b24gPSAnLm11bHRpLWFkZF9fcmVtb3ZlLWJ1dHRvbic7XG5cbiAgICAgICAgLy8gQ2xhc3MgbmFtZXNcbiAgICAgICAgdGhpcy5jbGFzc05hbWVSb3dFcnJvciA9ICdtdWx0aS1hZGRfX3Jvdy0tZXJyb3InO1xuXG4gICAgICAgIC8vIEZ1bmN0aW9uYWwgYXNzaWdubWVudHNcbiAgICAgICAgdGhpcy4kZm9ybSA9ICQoJy5tdWx0aS1hZGQnKTtcbiAgICAgICAgdGhpcy4kZmlsZSA9ICQoJy5jc3YtZmlsZScpO1xuICAgICAgICB0aGlzLnNuaXBwZXQgPSAkKHRoaXMuY2xhc3NSb3cpWzBdLm91dGVySFRNTDtcbiAgICAgICAgdGhpcy5saW5lcyA9IDE7XG4gICAgICAgIHRoaXMuc2VhcmNoVGVybXMgPSBbXTtcblxuICAgICAgICB0aGlzLnJlc2V0U3RhdGUoKTtcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgcmVzZXRTdGF0ZSgpIHtcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLmVycm9ycyA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRMb29wID0gMDtcbiAgICB9XG5cbiAgICAvLyBMb29wIGVycm9ycywgYWRkIGNsYXNzIGFuZCBjaGFuZ2UgdGV4dFxuICAgIGhhbmRsZUVycm9ycygpIHtcbiAgICAgICAgY29uc3Qgc2t1RXJyb3IgPSB0aGlzLmNvbnRleHQuc2t1RXJyb3I7XG5cbiAgICAgICAgJCh0aGlzLmVycm9ycykuZWFjaCgoaSwgZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcyh0aGlzLmNsYXNzTmFtZVJvd0Vycm9yKTtcbiAgICAgICAgICAgIC8vIFRvIGFkZCBsYW5nIHN0cmluZ1xuICAgICAgICAgICAgZWxlbWVudC5jaGlsZHJlbih0aGlzLmNsYXNzUmVzdWx0TWVzc2FnZSkudGV4dChza3VFcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJ1biBBSkFYIGNhbGxzIG9uZSBieSBvbmVcbiAgICBoYW5kbGVBamF4KCkge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50TG9vcCA8IHRoaXMuaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB1dGlscy5hcGkuZ2V0UGFnZSh0aGlzLml0ZW1zW3RoaXMuY3VycmVudExvb3BdLnVybCwge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnZi9iMmIvcXVpY2stYWRkLXJlc3BvbnNlJyxcbiAgICAgICAgICAgIH0sIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0UmVnZXggPSAvPHNjcmlwdFxcYltePF0qKD86KD8hPFxcL3NjcmlwdD4pPFtePF0qKSo8XFwvc2NyaXB0Pi9naTtcbiAgICAgICAgICAgICAgICBjb25zdCBjbGVhblJlc3BvbnNlID0gcmVzcG9uc2UucmVwbGFjZShzY3JpcHRSZWdleCwgJycpLnRyaW0oKTtcblxuICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGNsZWFuUmVzcG9uc2UubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXNbdGhpcy5jdXJyZW50TG9vcF0udGFyZ2V0LmNoaWxkcmVuKHRoaXMuY2xhc3NSZXN1bHRNZXNzYWdlKS50ZXh0KGNsZWFuUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMuaXRlbXNbdGhpcy5jdXJyZW50TG9vcF0udGFyZ2V0KS5hZGRDbGFzcygnbXVsdGktYWRkX19yb3ctLWFkdmlzb3J5Jyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtc1t0aGlzLmN1cnJlbnRMb29wXS50YXJnZXQuY2hpbGRyZW4odGhpcy5jbGFzc1Jlc3VsdE1lc3NhZ2UpLnRleHQoJCgnLm11bHRpLWFkZF9fc3VibWl0LWJ1dHRvbicpLmRhdGEoJ21lc3NhZ2UnKSk7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcy5pdGVtc1t0aGlzLmN1cnJlbnRMb29wXS50YXJnZXQpLmF0dHIoJ2RhdGEtc3RhdHVzJywgJ3N1Y2Nlc3MnKS5hZGRDbGFzcygnbXVsdGktYWRkX19yb3ctLXN1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJbmNyZW1lbnQgJ2N1cnJlbnQnIGFuZCBydW4gQUpBWCBjYWxsIGFnYWluXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50TG9vcCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3JzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBamF4KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExhc3QgYXR0ZW1wdCwgcmVkaXJlY3Qgb25seVxuICAgICAgICBpZiAodGhpcy5jdXJyZW50TG9vcCA9PT0gdGhpcy5pdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSAnL2NhcnQucGhwJztcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hDb3VudGVyKCk7XG4gICAgICAgICAgICAkKCcubXVsdGlfYWRkX19jYXJ0LWJ1dHRvbicpLmNzcygnZGlzcGxheScsICdpbmxpbmUtYmxvY2snKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZldGNoQ291bnRlcigpIHtcbiAgICAgICAgdXRpbHMuYXBpLmNhcnQuZ2V0Q29udGVudCh7IHRlbXBsYXRlOiAnZi9jYXJ0L2l0ZW0tY291bnQnIH0sIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UgPiAwKSB7XG4gICAgICAgICAgICAgICAgJCgnYm9keScpLnRyaWdnZXIoJ2NhcnQtcXVhbnRpdHktdXBkYXRlJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBoYW5kbGVCdXR0b25EaXNwbGF5KCkge1xuICAgICAgICBjb25zdCByb3dzID0gdGhpcy4kZm9ybS5jaGlsZHJlbih0aGlzLmNsYXNzUm93KTtcbiAgICAgICAgY29uc3QgcmVtb3ZlQnV0dG9ucyA9IHJvd3MuZmluZCh0aGlzLmNsYXNzUmVtb3ZlQnV0dG9uKTtcbiAgICAgICAgY29uc3QgYWRkQnV0dG9ucyA9IHJvd3MuZmluZCh0aGlzLmNsYXNzQWRkQnV0dG9uKTtcbiAgICAgICAgY29uc3QgbGFzdEFkZEJ1dHRvbiA9ICQocm93c1t0aGlzLmxpbmVzIC0gMV0pLmZpbmQodGhpcy5jbGFzc0FkZEJ1dHRvbik7XG5cbiAgICAgICAgaWYgKHRoaXMubGluZXMgPiAxKSB7XG4gICAgICAgICAgICByZW1vdmVCdXR0b25zLnJlbW92ZUNsYXNzKCdtdWx0aS1hZGRfX3JlbW92ZS1idXR0b24tLWxhc3QnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgYWRkQnV0dG9ucy5yZW1vdmVDbGFzcygnbXVsdGktYWRkX19hZGQtYnV0dG9uLS1kaXNhYmxlZCcpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICBhZGRCdXR0b25zLm5vdChsYXN0QWRkQnV0dG9uKS5hZGRDbGFzcygnbXVsdGktYWRkX19hZGQtYnV0dG9uLS1kaXNhYmxlZCcpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZW1vdmVCdXR0b25zLmFkZENsYXNzKCdtdWx0aS1hZGRfX3JlbW92ZS1idXR0b24tLWxhc3QnKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgYWRkQnV0dG9ucy5yZW1vdmVDbGFzcygnbXVsdGktYWRkX19hZGQtYnV0dG9uLS1kaXNhYmxlZCcpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBoYW5kbGVBZGRMaW5lKHNrdSwgcXR5KSB7XG4gICAgICAgIGNvbnN0IG5ld0xpbmUgPSAkKHRoaXMuc25pcHBldCkuY2xvbmUoKTtcblxuICAgICAgICBpZiAoc2t1ICYmIHF0eSkge1xuICAgICAgICAgICAgJChuZXdMaW5lWzBdLmNoaWxkcmVuWzBdKS52YWwoc2t1KTtcbiAgICAgICAgICAgICQobmV3TGluZVswXS5jaGlsZHJlblsxXSkudmFsKHF0eSk7XG4gICAgICAgIH1cblxuICAgICAgICAkKCcubXVsdGktYWRkX19zdWJtaXQtYnV0dG9uJykuYmVmb3JlKG5ld0xpbmUpO1xuICAgICAgICB0aGlzLmxpbmVzKys7XG5cbiAgICAgICAgdGhpcy5oYW5kbGVCdXR0b25EaXNwbGF5KCk7XG4gICAgfVxuXG4gICAgaGFuZGxlUmVtb3ZlTGluZShsaW5lKSB7XG4gICAgICAgIGlmIChsaW5lLmlzKCc6b25seS1vZi10eXBlJykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxpbmUucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMubGluZXMtLTtcblxuICAgICAgICB0aGlzLmhhbmRsZUJ1dHRvbkRpc3BsYXkoKTtcbiAgICB9XG5cbiAgICBoYW5kbGVJdGVtU2VsZWN0KGV2ZW50LCBvdmVycmlkZSkge1xuICAgICAgICBjb25zdCBzZWxmID0gKGV2ZW50KSA/ICQoZXZlbnQudGFyZ2V0KSA6IG92ZXJyaWRlO1xuICAgICAgICBjb25zdCByZWxhdGl2ZVJvdyA9IHNlbGYucGFyZW50cygnLm11bHRpLWFkZF9fcm93Jyk7XG4gICAgICAgIGNvbnN0IHJvd0luZGV4ID0gcmVsYXRpdmVSb3cuaW5kZXgoKSAtIDE7XG5cbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRTa3UgPSAkLnRyaW0oc2VsZi50ZXh0KCkpO1xuICAgICAgICBjb25zdCByZWxhdGl2ZUlucHV0ID0gcmVsYXRpdmVSb3cuZmluZCgnW2RhdGEtbXVsdGktc2t1XScpO1xuXG4gICAgICAgIHJlbGF0aXZlSW5wdXRbMF0udmFsdWUgPSBzZWxlY3RlZFNrdTtcbiAgICAgICAgdGhpcy5zZWFyY2hUZXJtc1tyb3dJbmRleF0gPSBzZWxlY3RlZFNrdTtcbiAgICB9XG5cbiAgICBwcm9jZXNzRm9ybShldmVudCwgZm9ybSkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGNvbnN0IGFsbFJvd3MgPSAkKGZvcm0pLmNoaWxkcmVuKHRoaXMuY2xhc3NSb3cpO1xuICAgICAgICBjb25zdCBhbGxNZXNzYWdlcyA9IGFsbFJvd3MuZmluZCh0aGlzLmNsYXNzUmVzdWx0TWVzc2FnZSk7XG4gICAgICAgIGNvbnN0IGFkZGluZ3RvQ2FydCA9IHRoaXMuY29udGV4dC5hZGRpbmdUb0NhcnQ7XG5cbiAgICAgICAgdGhpcy5yZXNldFN0YXRlKCk7XG5cbiAgICAgICAgLy8gRm9yIGVhY2ggcm93LCBhZGQgdGhlIFVSTCBhbmQgdGFyZ2V0IHRvIHRoZSBpdGVtcyBhcnJheVxuICAgICAgICBhbGxSb3dzLmVhY2goKGluZGV4LCByb3cpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9ICQocm93KTtcbiAgICAgICAgICAgIGNvbnN0IHNrdSA9IHRhcmdldC5maW5kKCdbZGF0YS1tdWx0aS1za3VdJykudmFsKCk7XG4gICAgICAgICAgICBjb25zdCBxdHkgPSB0YXJnZXQuZmluZCgnW2RhdGEtbXVsdGktcXR5XScpLnZhbCgpO1xuXG4gICAgICAgICAgICBpZiAoIXNrdSB8fCAhcXR5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaCh0YXJnZXQpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdXJsID0gYC9jYXJ0LnBocD9hY3Rpb249YWRkJnNrdT0ke3NrdX0mcXR5PSR7cXR5fWA7XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgICAgIHRhcmdldCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBUbyBhZGQgbGFuZyBzdHJpbmdcbiAgICAgICAgYWxsTWVzc2FnZXMudGV4dChhZGRpbmd0b0NhcnQpO1xuICAgICAgICB0aGlzLmhhbmRsZUFqYXgoKTtcbiAgICB9XG5cbiAgICBwYXJzZUNTVihldmVudCwgX3RoaXMpIHtcbiAgICAgICAgJCgnLmFsZXJ0Qm94LW1lc3NhZ2Ugc3BhbicpLnRleHQoJycpO1xuICAgICAgICAkKCcuYWxlcnRCb3gnKS5oaWRlKCk7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07XG4gICAgICAgIGxldCBub1NrdTtcbiAgICAgICAgbGV0IG5vUXR5O1xuICAgICAgICBjb25zdCBjc3ZNaXNzaW5nU2t1SGVhZGVyID0gdGhpcy5jb250ZXh0LmNzdk1pc3NpbmdTa3VIZWFkZXI7XG4gICAgICAgIGNvbnN0IGNzdk1pc3NpbmdRdHlIZWFkZXIgPSB0aGlzLmNvbnRleHQuY3N2TWlzc2luZ1F0eUhlYWRlcjtcblxuICAgICAgICBwYXJzZShmaWxlLCB7XG4gICAgICAgICAgICBwcmV2aWV3OiAxLFxuICAgICAgICAgICAgY29tcGxldGUocmVzdWx0cykge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHRzLmRhdGFbMF0uaW5kZXhPZignc2t1JykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vU2t1ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0cy5kYXRhWzBdLmluZGV4T2YoJ3F0eScpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBub1F0eSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG5vUXR5IHx8IG5vU2t1KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub1NrdSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmFsZXJ0Qm94LW1lc3NhZ2Ugc3BhbicpLmFwcGVuZChjc3ZNaXNzaW5nU2t1SGVhZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9RdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5hbGVydEJveC1tZXNzYWdlIHNwYW4nKS5hcHBlbmQoY3N2TWlzc2luZ1F0eUhlYWRlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJCgnLmFsZXJ0Qm94Jykuc2hvdygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlKGZpbGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR5bmFtaWNUeXBpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2tpcEVtcHR5TGluZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGVwKHJvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNrdSA9IHJvdy5kYXRhWzBdLnNrdTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBxdHkgPSByb3cuZGF0YVswXS5xdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlQWRkTGluZShza3UsIHF0eSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBCaW5kIGV2ZW50IGhhbmRsZXJzXG4gICAgYmluZEV2ZW50cygpIHtcbiAgICAgICAgdGhpcy4kZm9ybS5vbignY2xpY2snLCB0aGlzLmNsYXNzQWRkQnV0dG9uLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUFkZExpbmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy4kZm9ybS5vbignY2xpY2snLCB0aGlzLmNsYXNzUmVtb3ZlQnV0dG9uLCBldmVudCA9PiB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZVJlbW92ZUxpbmUoJChldmVudC50YXJnZXQpLnBhcmVudCgpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy4kZm9ybS5vbignY2hhbmdlJywgJ1tkYXRhLW11bHRpLXNrdV0nLCBldmVudCA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWxmID0gJChldmVudC50YXJnZXQpO1xuXG4gICAgICAgICAgICBpZiAoc2VsZi52YWwoKSkge1xuICAgICAgICAgICAgICAgIHNlbGYuc2libGluZ3ModGhpcy5jbGFzc1Jlc3VsdE1lc3NhZ2UpLnRleHQoJycpO1xuICAgICAgICAgICAgICAgIHNlbGYucGFyZW50KCkucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc05hbWVSb3dFcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuJGZvcm0ub24oJ3N1Ym1pdCcsIGV2ZW50ID0+IHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0Zvcm0oZXZlbnQsIHRoaXMuJGZvcm1bMF0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLiRmaWxlLm9uKCdjaGFuZ2UnLCBldmVudCA9PiB7XG4gICAgICAgICAgICB0aGlzLnBhcnNlQ1NWKGV2ZW50LCB0aGlzKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbIlBhZ2VNYW5hZ2VyIiwidXRpbHMiLCJwYXJzZSIsIlBhZ2UiLCJfUGFnZU1hbmFnZXIiLCJhcHBseSIsImFyZ3VtZW50cyIsIl9pbmhlcml0c0xvb3NlIiwiX3Byb3RvIiwicHJvdG90eXBlIiwib25SZWFkeSIsImNsYXNzUm93IiwiY2xhc3NSZXN1bHRNZXNzYWdlIiwiY2xhc3NBZGRCdXR0b24iLCJjbGFzc1JlbW92ZUJ1dHRvbiIsImNsYXNzTmFtZVJvd0Vycm9yIiwiJGZvcm0iLCIkIiwiJGZpbGUiLCJzbmlwcGV0Iiwib3V0ZXJIVE1MIiwibGluZXMiLCJzZWFyY2hUZXJtcyIsInJlc2V0U3RhdGUiLCJiaW5kRXZlbnRzIiwiaXRlbXMiLCJlcnJvcnMiLCJjdXJyZW50TG9vcCIsImhhbmRsZUVycm9ycyIsIl90aGlzMiIsInNrdUVycm9yIiwiY29udGV4dCIsImVhY2giLCJpIiwiZWxlbWVudCIsImFkZENsYXNzIiwiY2hpbGRyZW4iLCJ0ZXh0IiwiaGFuZGxlQWpheCIsIl90aGlzMyIsImxlbmd0aCIsImFwaSIsImdldFBhZ2UiLCJ1cmwiLCJ0ZW1wbGF0ZSIsImVyciIsInJlc3BvbnNlIiwic2NyaXB0UmVnZXgiLCJjbGVhblJlc3BvbnNlIiwicmVwbGFjZSIsInRyaW0iLCJFcnJvciIsInRhcmdldCIsImRhdGEiLCJhdHRyIiwiZmV0Y2hDb3VudGVyIiwiY3NzIiwiY2FydCIsImdldENvbnRlbnQiLCJ0cmlnZ2VyIiwiaGFuZGxlQnV0dG9uRGlzcGxheSIsInJvd3MiLCJyZW1vdmVCdXR0b25zIiwiZmluZCIsImFkZEJ1dHRvbnMiLCJsYXN0QWRkQnV0dG9uIiwicmVtb3ZlQ2xhc3MiLCJyZW1vdmVBdHRyIiwibm90IiwiaGFuZGxlQWRkTGluZSIsInNrdSIsInF0eSIsIm5ld0xpbmUiLCJjbG9uZSIsInZhbCIsImJlZm9yZSIsImhhbmRsZVJlbW92ZUxpbmUiLCJsaW5lIiwiaXMiLCJyZW1vdmUiLCJoYW5kbGVJdGVtU2VsZWN0IiwiZXZlbnQiLCJvdmVycmlkZSIsInNlbGYiLCJyZWxhdGl2ZVJvdyIsInBhcmVudHMiLCJyb3dJbmRleCIsImluZGV4Iiwic2VsZWN0ZWRTa3UiLCJyZWxhdGl2ZUlucHV0IiwidmFsdWUiLCJwcm9jZXNzRm9ybSIsImZvcm0iLCJfdGhpczQiLCJwcmV2ZW50RGVmYXVsdCIsImFsbFJvd3MiLCJhbGxNZXNzYWdlcyIsImFkZGluZ3RvQ2FydCIsImFkZGluZ1RvQ2FydCIsInJvdyIsInB1c2giLCJwYXJzZUNTViIsIl90aGlzIiwiaGlkZSIsImZpbGUiLCJmaWxlcyIsIm5vU2t1Iiwibm9RdHkiLCJjc3ZNaXNzaW5nU2t1SGVhZGVyIiwiY3N2TWlzc2luZ1F0eUhlYWRlciIsInByZXZpZXciLCJjb21wbGV0ZSIsInJlc3VsdHMiLCJpbmRleE9mIiwiYXBwZW5kIiwic2hvdyIsImhlYWRlciIsImR5bmFtaWNUeXBpbmciLCJza2lwRW1wdHlMaW5lcyIsInN0ZXAiLCJfdGhpczUiLCJvbiIsInBhcmVudCIsInNpYmxpbmdzIiwiZGVmYXVsdCJdLCJzb3VyY2VSb290IjoiIn0=